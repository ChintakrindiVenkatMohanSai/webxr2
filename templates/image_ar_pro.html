<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>Image AR Overlay</title>

<style>
body{
margin:0;
overflow:hidden;
background:black;
font-family:Arial;
}

/* Camera video */
video{
position:fixed;
top:0;
left:0;
width:100%;
height:100%;
object-fit:cover;
z-index:1;
}

/* AR Image overlay */
#overlay{
position:fixed;
top:50%;
left:50%;
transform:translate(-50%,-50%);
width:250px;
z-index:10;
touch-action:none;
}

/* UI */
.ui{
position:fixed;
top:20px;
left:50%;
transform:translateX(-50%);
z-index:20;
color:white;
background:rgba(0,0,0,.6);
padding:10px 18px;
border-radius:10px;
font-size:14px;
}
</style>
</head>

<body>

<div class="ui">
ðŸ“± Drag â€¢ Pinch Zoom â€¢ Rotate
</div>

<script>
let overlay;
let scale=1, rotation=0, posX=0, posY=0;
let startDist=0, startAngle=0;

async function startCamera(){
try{
const stream = await navigator.mediaDevices.getUserMedia({
video:{ facingMode:"environment" }
});

let video=document.createElement("video");
video.srcObject=stream;
video.autoplay=true;
document.body.appendChild(video);

// Image overlay
overlay=document.createElement("img");
overlay.id="overlay";
overlay.src="/uploads/{{img}}";
document.body.appendChild(overlay);

initGestures();

}catch(e){
alert("Camera not supported or blocked");
}
}

function initGestures(){

let prevX, prevY;

overlay.addEventListener("touchstart",e=>{
if(e.touches.length==1){
prevX=e.touches[0].clientX;
prevY=e.touches[0].clientY;
}
if(e.touches.length==2){
startDist=getDist(e);
startAngle=getAngle(e);
}
});

overlay.addEventListener("touchmove",e=>{
e.preventDefault();

if(e.touches.length==1){
let dx=e.touches[0].clientX-prevX;
let dy=e.touches[0].clientY-prevY;

posX+=dx;
posY+=dy;
prevX=e.touches[0].clientX;
prevY=e.touches[0].clientY;
}

if(e.touches.length==2){

let newDist=getDist(e);
scale*=newDist/startDist;
startDist=newDist;

let newAngle=getAngle(e);
rotation+=newAngle-startAngle;
startAngle=newAngle;
}

updateTransform();
});
}

function updateTransform(){
overlay.style.transform =
`translate(calc(-50% + ${posX}px),
calc(-50% + ${posY}px))
scale(${scale}) rotate(${rotation}deg)`;
}

function getDist(e){
let dx=e.touches[0].clientX-e.touches[1].clientX;
let dy=e.touches[0].clientY-e.touches[1].clientY;
return Math.sqrt(dx*dx+dy*dy);
}

function getAngle(e){
let dx=e.touches[1].clientX-e.touches[0].clientX;
let dy=e.touches[1].clientY-e.touches[0].clientY;
return Math.atan2(dy,dx)*180/Math.PI;
}

window.onload=startCamera;
</script>

</body>
</html>